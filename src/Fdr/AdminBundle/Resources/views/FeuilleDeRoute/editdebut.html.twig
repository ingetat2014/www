{% extends "FOSUserBundle::layout.html.twig" %}
{% block title %}Feuille de route|Edit-Debut{% endblock %}
{% block fos_user_content %}
{% block body -%}
<div class="page-header">  <h2> Modification de feuille de route(Début de mission-{{ entity }})[{{ entity.etat|capitalize }}]</h2> </div>  

{{ form_start(edit_form) }}
<div class="row">
    <span class="alert-danger ">{{ form_errors(edit_form) }}</span>
</div>

<div class="row">
    <div class="span7">
        <div class="row">
            <div class="span4">
                <fieldset>
                    <legend>Déroulement de mission  </legend>
                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.fdrInstance," ") }}</div>
                        <div class="span3"><label>En instance</label></div>
                        {% if not role.upFDR or entity.etat is sameas('cloturer')  %}  
                        {% if entity.fdrInstance %}
                    <input type="checkbox" disabled readonly checked />
                {%else %}
                    <input type="checkbox" disabled readonly />
                {%endif %}
                    
                        <span class="cacher">{{ form_widget(edit_form.fdrInstance,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        
                        <span class="span8 cacher">{{ form_widget(edit_form.fdrInstance) }}</span>
                        {%endif%}  
                        <span class="alert-danger ">{{ form_errors(edit_form.fdrInstance) }}</span>
                        
                    </div>
                    
                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.dateDebutMission," ") }}</div>
                        <div class="span3"><label>Debut Mission</label></div>
                        {% if not role.upFDR  %}  
                        <div class="span8">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.dateDebutMission|date(('Y-m-d H:i:s'))}}"/>
                        </div>
                        <span class="cacher">{{ form_widget(edit_form.dateDebutMission,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span8">{{ form_widget(edit_form.dateDebutMission) }}</span>
                        {%endif%}                        
                        <span class="alert-danger ">{{ form_errors(edit_form.dateDebutMission) }}</span>
                    </div>

                    <div class="row-fluid {{role.crFDRAutrAgence?'':'cacher'}}">
                        <div class="span1">{{ form_label(edit_form.filiale," ") }}</div>
                        <div class="span3"><label>Filiale</label></div>

                        {% if not role.upFDR  %} 
                        <div class="span8">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.filiale}}"/>
                        </div>
                        <span class="cacher">{{ form_widget(edit_form.filiale,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span8">{{ form_widget(edit_form.filiale) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.filiale) }}</span>
                    </div>

                    <div class="row-fluid {{role.crFDRAutrAgence?'':'cacher'}}">
                        <div class="span1">{{ form_label(edit_form.depot," ") }}</div>
                        <div class="span3"><label>Depôt</label></div>

                        {% if not role.upFDR  %} 
                        <div class="span8">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.depot}}"/></div>
                        <span class="cacher">{{ form_widget(edit_form.depot,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span8">{{ form_widget(edit_form.depot) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.depot) }}</span>
                    </div>

                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.vehicule," ") }}</div>
                        <div class="span3"><label>Vehicule</label></div>

                        {% if not role.upFDR and not role.affectationVehicule%} 
                        <div class="span8">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.vehicule}}"/></div>
                        <span class="cacher">{{ form_widget(edit_form.vehicule,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span8">{{ form_widget(edit_form.vehicule) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.vehicule) }}</span>
                    </div>

                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.compteurReel," ") }}</div>
                        <div class="span3"><label>Compteur Réel</label></div>

                        {% if not role.upFDR and not role.editCompteur%} 
                        <div class="span8">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.compteurReel}}"/></div>
                        <span class="cacher">{{ form_widget(edit_form.compteurReel,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span8">{{ form_widget(edit_form.compteurReel) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.compteurReel) }}</span>
                    </div>

                </fieldset>
            </div>

            <div class="span3">
                <fieldset> 
                    <legend>Prestation/Clients/Secteurs </legend>

                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.typePrestation," ") }}</div>
                        <div class="span11"><label>Prestation : </label></div>

                        {% if not role.upFDR %} 
                        <div class="span5">
                            <input type="text" readonly="readonly" 
                                   value="{{entity.typePrestation}}"/></div>
                        <span class="cacher">{{ form_widget(edit_form.typePrestation,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span5">{{ form_widget(edit_form.typePrestation) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.typePrestation) }}</span>
                    </div>

                    <div class="row-fluid">
                        <div class="span1">{{ form_label(edit_form.secteurs," ") }}</div>
                        <div class="span11"><label>Secteurs : </label></div>

                        {% if not role.upFDR  %} 
                        <div class="span11">
                            <ul>
                        {%for item in entity.secteurs%}
                                <li>{{item}}</li>
                            {%endfor%}
                            </ul>
                        </div>
                        <span class="cacher">{{ form_widget(edit_form.secteurs,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                        <span class="span11">{{ form_widget(edit_form.secteurs) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.secteurs) }}</span>
                    </div>

                    <div class="row-fluid">
                        <div class="span12">{{ form_label(edit_form.clients," ") }}</div>
                        <div class="span12"><label>Clients : </label></div>

                        {% if not role.upFDR  %} 
                        <div class="span12">
                            <ul>
                        {%for item in entity.clientFdrVs%}
                                <li>{{item.client|trim('*/')}}</li>
                            {%endfor%}
                            </ul>
                        </div>
                        <span class="cacher">{{ form_widget(edit_form.clients,{'attr': {'novalidate': 'novalidate','class':'cacher'}}) }}</span>
                        {%else%}
                        <span class="span12">{{ form_widget(edit_form.clients,{'attr': {'novalidate': 'novalidate'}}) }}</span>
                        {%endif%}
                        <span class="alert-danger ">{{ form_errors(edit_form.clients) }}</span>
                    </div>

                </fieldset>
            </div>
        </div>
        <div class="row">
            <div class="span6">
                <fieldset>
                    <legend> Manutentions Externes </legend>
                    <div class="span3">
                        <fieldset>
                            <legend class="subfieldset" style="text-align: center"> 1 </legend>

                            <div class="row-fluid">
                                <div class="span1">{{ form_label(edit_form.nomManExterne1," ") }}</div>
                                <div class="span11"><label>Man. Ext1</label></div>

                        {% if not role.upFDR  %} 
                                <div class="span11">
                                    <input type="text" readonly="readonly" 
                                           value="{{entity.nomManExterne1}}"/>
                                </div>
                                <div class="span11 cacher">{{ form_widget(edit_form.nomManExterne1,{'attr': {'class': 'cacher'}}) }}</div>
                        {%else%}
                                <span class="span11">{{ form_widget(edit_form.nomManExterne1) }}</span>
                        {%endif%}
                                <span class="alert-danger ">{{ form_errors(edit_form.nomManExterne1) }}</span>
                            </div>

                            <div class="row-fluid">
                                <div class="span1">{{ form_label(edit_form.cinManExterne1," ") }}</div>
                                <div class="span11"><label>CIN Ext1</label></div>

                        {% if not role.upFDR  %} 
                                <div class="span11">
                                    <input type="text" readonly="readonly" 
                                           value="{{entity.cinManExterne1}}"/>
                                </div>
                                <div class="span11 cacher">{{ form_widget(edit_form.cinManExterne1,{'attr': {'class': 'cacher'}}) }}</div>
                        {%else%}
                                <span class="span11">{{ form_widget(edit_form.cinManExterne1) }}</span>
                        {%endif%}
                                <span class="alert-danger ">{{ form_errors(edit_form.cinManExterne1) }}</span>
                            </div>
                        </fieldset>
                    </div>
                    <div class="span3">
                        <fieldset>
                            <legend class="subfieldset" style="text-align: center"> 2 </legend>
                            <div class="row-fluid">
                                <div class="span1">{{ form_label(edit_form.nomManExterne2," ") }}</div>
                                <div class="span11"><label>Man. Ext2</label></div>

                        {% if not role.upFDR  %} 
                                <div class="span11">
                                    <input type="text" readonly="readonly" 
                                           value="{{entity.nomManExterne2}}"/>
                                </div>
                                <div class="span11 cacher">{{ form_widget(edit_form.nomManExterne2,{'attr': {'class': 'cacher'}}) }}</div>
                        {%else%}
                                <span class="span11">{{ form_widget(edit_form.nomManExterne2) }}</span>
                        {%endif%}
                                <span class="alert-danger ">{{ form_errors(edit_form.nomManExterne2) }}</span>
                            </div>

                            <div class="row-fluid">
                                <div class="span1">{{ form_label(edit_form.cinManExterne2," ") }}</div>
                                <div class="span11"><label>CIN Ext2</label></div>

                        {% if not role.upFDR  %} 
                                <div class="span11">
                                    <input type="text" readonly="readonly" 
                                           value="{{entity.cinManExterne2}}"/>
                                </div>
                                <div class="span11 cacher">{{ form_widget(edit_form.cinManExterne2,{'attr': {'class': 'cacher'}}) }}</div>
                        {%else%}
                                <span class="span11">{{ form_widget(edit_form.cinManExterne2) }}</span>
                        {%endif%}
                                <span class="alert-danger ">{{ form_errors(edit_form.cinManExterne2) }}</span>
                            </div>
                        </fieldset>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <div class="span4">
        <fieldset>
            <legend> Manutention/Chauffeur </legend>
            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.nombreManutention," ") }}</div>
                <div class="span4"><label>Nombre Manutentions</label></div>

                        {% if not role.upFDR and not role.affectationChauffManu %} 
                <div class="span7">
                    <input type="text" readonly="readonly" 
                           value="{{entity.nombreManutention}}"/></div>
                <span class="cacher">{{ form_widget(edit_form.nombreManutention,{'attr': {'class': 'cacher'}}) }}</span>
                        {%else%}
                <span class="span8">{{ form_widget(edit_form.nombreManutention) }}</span>
                        {%endif%}
                <span class="alert-danger ">{{ form_errors(edit_form.nombreManutention) }}</span>
            </div>
            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.manutentions," ") }}</div>
                <div class="span10"><label>Les Chauffeurs/Manutentionnaires :</label>
                    <div id="Span2" class="cacher" style="width: 250px;"><span class="text-danger badge-error badge center-block"> Nota Bene : </span><br/>
                        {% for man in entity.manutentions %}
                        -{{ man}} : <span class="{{man.disponibilite==1?'text-success':'text-danger'}}">{{man.disponibilite==1?'Disponible':'Indisponible'}}</span>{%if not loop.last%} <br/>{%endif%}                 
                       {% endfor %}
                        <div class="text-info">La liste déroulante contient normalement que ceux qui portent l'état <strong style="color: green;">"Disponible"</strong> 
                            <br/>et <strong class="text-danger">excepté </strong> ceux qui étaient séléctionnés au préalable: </div>
                        <div style="font-family: monospace;">La feuille est <strong style="color: blue;">"{{ entity.etat|capitalize }}"</strong>
                            {%if entity.etat is sameas("cloturer")%}Tout changement des chauffeurs(ou Manutentionnaire) séléctionnés; n'aura aucun impact sur leurs disponibilités
                            {%elseif entity.etat is sameas("ouverte")%}Dans le cas ou un chauffeur(ou Manutentionnaire) séléctionné est <strong style="color: red;">"Indisponible"</strong> ;
                            <br/>vous pouvez cocher la case en instance pour les rendre <strong style="color: green;">"Disponible"</strong> <br/><span class="alert-danger">Mais si jamais un des séléctionnés(ayant état:indisponible); a été changé => il ne sera plus recupéré</span> {%endif%} 
                            <br><span class="text-center text-warning danger">Si jamais vous aurez besoin de changer <strong class="text-danger">"explicitement"</strong> la dispinibilité d'un chauffeur(& Manu.) 
                                <br/>Vous pouvez Contacter la personne qui en a le droit.</span>
                        </div>    </div>
                    <img  onmouseover="TagToTip('Span2');" onmouseout="UnTip();" class="img-circle" title="Information importante" src="{{ asset('bundles/fdradmin/images/alerte.png') }}"/></div>
                        {% if not role.upFDR and not role.affectationChauffManu%}
                <div class="span11">
                {% for man in entity.manutentions %}
                        -<input style="white-space:normal;text-overflow: string;" type="text" value="{{ man}}" size="35" readonly/>{%if not loop.last%} <br/>{%endif%} 
                {% else %}
                        -<input type="text" value="Aucun" size="35" readonly/>                  
                {% endfor %}
                </div>
                <span class="span11 cacher">{{ form_widget(edit_form.manutentions,{'attr': {'class': 'cacher'}}) }}</span>
                      {%else%}
                <span class="span8">{{ form_widget(edit_form.manutentions) }}</span> 
                      {%endif%}

                <span class="alert-danger ">{{ form_errors(edit_form.manutentions) }}</span>
            </div>
        </fieldset>
    </div>
</div>

<div class="row-fluid">
    <div class="span8 offset5"><span class="">{{ form_widget(edit_form.submit) }}</span>
    </div>
</div>

<div class="cacher">{{ form_rest(edit_form,{'attr': {'class': 'cacher'}}) }}</div>
    {{ form_end(edit_form) }}
<div class="row-fluid" class="pull-right">
    {%if role.affFDR%}
    <a target="_blank" href="{{ path('feuillederoute') }}" >
        Revenir à la liste
    </a>
    {%endif%}
    &nbsp;&nbsp;
    <a target="_blank" href="{{ path('feuillederoute_show', { 'id': entity.id }) }}">
        Afficher la feuille
    </a>
</div>
<script>
        jQuery(document).ready(function() {
        var secteurs = document.getElementById("fdr_adminbundle_feuillederoute_secteurs");
        var $container = $('div#fdr_adminbundle_feuillederoute_manutentions');
        var $addLink = $('<br/><a href="#" id="add_manutention" class="btn btn-default">Ajouter Manu.</a>');
        $container.append($addLink);
        $container.data('index', $container.children('div').length);
        boucler('chauffeur');
        boucler('manutentionnaire');

        $addLink.click(function(e) {
            var global = parseInt("0" + $("#fdr_adminbundle_feuillederoute_nombreManutention").val());
            $("#fdr_adminbundle_feuillederoute_nombreManutention").val(global);
            var tot = 0;
            for (i = 0; i < $("*[id$='_nombreManutentions']").length; i++)
            {
                var elt = parseInt("0" + $("*[id$='_nombreManutentions']").get(i).value);
                $("*[id$='_nombreManutentions']").get(i).value = elt;
                tot += elt;
            }
            if (tot <= global) {
                addManutention($container);
                $container.data('index', $container.data('index') + 1);
                if ($container.children('div').length >= 3)
                {
                    $('#add_manutention').hide(200);
                    $('#add_manutention').disabled = true;
                }
            }
            else {
                alert('Le total des manutentions (' + tot + ') est > au nombre total (' + global + '),on va reinitialiser ces champs');
                $("*[id$='_nombreManutentions']").val(0);
                $("*[id$='_nombreManutentions']").css('border-color', 'red');
                $("#fdr_adminbundle_feuillederoute_nombreManutention").css('border-color', 'red');
            }
            e.preventDefault();
            return false;
        });
        if ($container.data('index') === 0) {
            addManutention($container);
            $container.data('index', $container.data('index') + 1);
        }
        else {
            $container.children('div').each(function() {
                addDeleteLink($(this));

            });
        }
        function addManutention($container) {

            var $prototype = $($container.attr('data-prototype').replace(/__name__label__/g, 'Manutention N°' + ($container.data('index') + 1))
                    .replace(/__name__/g, ($container.data('index'))));
            addDeleteLink($prototype);
            $container.append($prototype);
            visibilte($container.data('index'), false);

        }

        function addDeleteLink($prototype) {
            $deleteLink = $('<a href="#" class="btn btn-danger btn-sm">Supprimer</a>');
            $prototype.append($deleteLink);
            $deleteLink.click(function(e) {
                if ($container.children('div').length <= 5 && $container.children('div').length > 1)
                {
                    $prototype.remove();
                    $('#add_manutention').show(200);
                    $('#add_manutention').disabled = false;
                }
                e.preventDefault();
                return false;
            });
        }
    });
    function boucler(qui)
    {
        for (i = 0; i < $("select[id$='_" + qui + "']").length; i++)
        {
            if ($("select[id$='_" + qui + "'] option:selected").get(i).value)
            {
                selectionnerManOuChauff($("select[id$='_" + qui + "'] option:selected").get(i).parentNode.getAttribute('id'), qui);
            }
        }

    }

    function selectionnerManOuChauff(id, qui){
        var res = id.split("_");
        var manlst = "#fdr_adminbundle_feuillederoute_manutentions_" + res[res.length - 2] + "_manutentionnaire";
        var chaufflst = "#fdr_adminbundle_feuillederoute_manutentions_" + res[res.length - 2] + "_chauffeur";
        var manOuChauff = "#fdr_adminbundle_feuillederoute_manutentions_" + res[res.length - 2] + "_manOuChauff option[value='" + qui + "']";
        var nbreManu = "#fdr_adminbundle_feuillederoute_manutentions_" + res[res.length - 2] + "_nombreManutentions";
        var ayantMan = "#fdr_adminbundle_feuillederoute_manutentions_" + res[res.length - 2] + "_ayantManutentions";
        $(manOuChauff).prop('selected', true);
        if (qui === 'chauffeur')
        {
            $(manlst+ ' option[value=""]').attr('selected', 'selected');
            $(manlst+ ' option[value!=""]').attr('selected', false);
            $(manlst).hide();
            $(chaufflst).show();
        }
        else if (qui === 'manutentionnaire')
        {
            $(chaufflst+ ' option[value=""]').attr('selected', 'selected');
            $(chaufflst+ ' option[value!=""]').attr('selected', false);
            $(chaufflst).hide();
            $(manlst).show();

        }
        else
        {
            $(chaufflst).hide();
            $(manlst).hide();
        }
        $(ayantMan).attr('checked', true);
        
    }

    function visibilte(id, etat)
    {
        var manlst = "#fdr_adminbundle_feuillederoute_manutentions_" + id + "_manutentionnaire";
        var chaufflst = "#fdr_adminbundle_feuillederoute_manutentions_" + id + "_chauffeur";
        var nbreManu = "#fdr_adminbundle_feuillederoute_manutentions_" + id + "_nombreManutentions";
        if (etat === false)
        {
            $(manlst).hide();
            $(chaufflst).hide();
            $(nbreManu).hide();
        }
        else
        {
            $(manlst).show();
            $(chaufflst).show();
            $(nbreManu).show();
        }
    }
    function verifMan() {
        for (i = 0; i < $("*[id$='_chauffeur']").length; i++)
        {
            for (j = i + 1; j < $("*[id$='_chauffeur']").length; j++)
            {
                if ($("*[id$='_chauffeur']").get(i).value === $("*[id$='_chauffeur']").get(j).value
                        && $("*[id$='_chauffeur']").get(i).value !== ""
                        && $("*[id$='_manOuChauff']").get(i).value === $("*[id$='_manOuChauff']").get(j).value)
                {
                    alert("Un seul/unique chauffeur pour chaque choix");
                    return false;
                }
            }
        }
        for (i = 0; i < $("*[id$='_manutentionnaire']").length; i++)
        {
            for (j = i + 1; j < $("*[id$='_manutentionnaire']").length; j++)
            {
                if ($("*[id$='_manutentionnaire']").get(i).value === $("*[id$='_manutentionnaire']").get(j).value
                        && $("*[id$='_manutentionnaire']").get(i).value !== ""
                        && $("*[id$='_manOuChauff']").get(i).value === $("*[id$='_manOuChauff']").get(j).value)
                {
                    alert("Un seul/unique manutentionnaire pour chaque choix");
                    return false;
                }
            }
        }
        if (true)
        {
            var global = parseInt("0" + $("#fdr_adminbundle_feuillederoute_nombreManutention").val());
            $("#fdr_adminbundle_feuillederoute_nombreManutention").val(global);
            var tot = 0;
            for (i = 0; i < $("*[id$='_nombreManutentions']").length; i++)
            {
                var elt = parseInt("0" + $("*[id$='_nombreManutentions']").get(i).value);
                $("*[id$='_nombreManutentions']").get(i).value = elt;
                tot += elt;
            }
            if (tot > global) {
                alert("La répartition des manutentions n'est pas correcte(Le total des manutentions doit être <= au nombre voulu des manu.,on va reinitialiser ces champs )");
                $("*[id$='_nombreManutentions']").val(0);
                $("*[id$='_nombreManutentions']").css('border-color', 'red');
                $("#fdr_adminbundle_feuillederoute_nombreManutention").css('border-color', 'red');
                return false;
            }


            else
            {
                $("*[id$='_nombreManutentions']").css('border-color', '#515151');
                if (tot === global) {
                    $("*[id='fdr_adminbundle_feuillederoute_nomManExterne1']").val("");
                    $("*[id='fdr_adminbundle_feuillederoute_nomManExterne2']").val("");
                    $("*[id='fdr_adminbundle_feuillederoute_cinManExterne1']").val("");
                    $("*[id='fdr_adminbundle_feuillederoute_cinManExterne2']").val("");
                }
                if ($("*[id$='_nombreManutentions']").css('border-color') === 'rgb(255,0,0)')
                {
                    $("*[id$='_nombreManutentions']").css('border-color', 'green');
                    $("#fdr_adminbundle_feuillederoute_nombreManutention").css('border-color', 'green');
                }
                if($("*[id$='_manOuChauff'] option:selected[value='chauffeur']").length===0 && $("*[id$='_manOuChauff'] option:selected[value='']").length===0)
                {
                    alert("Un chauffeur au minimum doit etre selectionne");
                    return false;
                }
                return true;
            }

        } else {
        }
    }
    /***********edit-fdr*******/
    //selectionnerLesClients();
    function selectionnerLesClients(){
    var select = document.getElementById('fdr_adminbundle_feuillederoute_clients');
    var selectSec = document.getElementById('fdr_adminbundle_feuillederoute_secteurs');
    var fdrTsCl = document.getElementById('fdr_adminbundle_feuillederoute_hid_clientsFdrTs');
    var fdrTsClSel = document.getElementById('fdr_adminbundle_feuillederoute_hid_clientsFdrSelected');
    var tsClients = fdrTsCl.value.split('@');
    var tsClientsSel = fdrTsClSel.value.split('@');
    var ligne = null;
    var existe = false;
    var indexAsupprimer = new Array();
    var supp = 0;
    //secteurs
    for (var i = 0; i < selectSec.options.length; i++)
    {
        var o = selectSec.options[i];
        for (var j = 0; j < tsClients.length; j++) {
            ligne = tsClients[j].split("-");
            if (o.value === ligne[3]) {
                existe = true;
                break;
            }
            else {
                existe = false;
                continue;
            }
        }
        if (!existe) {
            indexAsupprimer.push(i);
        }       
    }
    
    for (var k = 0; k < indexAsupprimer.length; k++)
    {
        selectSec.options[indexAsupprimer[k - supp]] = null;
        supp++;
    }
    select.options.length=0;
    for (var j = 0; j < tsClients.length; j++) {
        if(tsClients[j]){
            ligne = tsClients[j].split("-");
        if ((ligne[0].substr(0, 2)) === "*/")
        {
            ligne[0] = ligne[0].substr(2);
        }
        
        select.options[select.length] = new Option(ligne[0]+"."+ligne[2], ligne[1]+"-"+ligne[3], true, false);
        
        for (var k = 0; k < tsClientsSel.length; k++){
            if(tsClients[k]){
            var selligne = tsClientsSel[k].split("-");
            if ((selligne[0].substr(0, 2)) === "*/")
            {
            selligne[0] = selligne[0].substr(2);
            }
            
            if (ligne[1] + "-" + ligne[3] === selligne[1] + "-" + selligne[3])
            {
               select.options[select.length-1].selected=true;
            }
        }
        }
    }
    }
}
</script>
{% endblock %}
{% endblock fos_user_content %}