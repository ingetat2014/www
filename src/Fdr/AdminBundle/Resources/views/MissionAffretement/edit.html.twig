{% extends "FOSUserBundle::layout.html.twig" %}
{% block title %}Feuille d'Affretement|Edit{% endblock %}
{% block fos_user_content %}
<div class="page-header"><h1> Modification d'une feuille de mission({{entity}})<span class="badge"> {{entity.etat}}</span></h1></div>

{{ form_start(edit_form) }}
<div class="row">
    <span class="alert-danger ">{{ form_errors(edit_form) }}</span>
</div>

<div class="span12">
    <div class="row-fluid">
        <div class="span3">{{ form_label(edit_form.dateGeneree,"Date ouverture :") }}</div>
        <div class="span3">{{ form_widget(edit_form.dateGeneree) }}</div>
    </div>
</div>
<div class="row">
    <div class="span4">
        <fieldset>
            <legend>Ramassage : </legend>
            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.dateramassage," ") }}</div>
{{ form_widget(edit_form.dateramassage) }}<span class="alert-danger ">{{ form_errors(edit_form.dateramassage) }}</span>
            </div>
            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.lieuramassage," ") }}</div>
{{ form_widget(edit_form.lieuramassage) }}<span class="alert-danger ">{{ form_errors(edit_form.lieuramassage) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.typeVehicule," ") }}</div>
<div class="">{{ form_widget(edit_form.typeVehicule) }}</div>
<span class="alert-danger ">{{ form_errors(edit_form.typeVehicule) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.nombreManutentionVoulu," ") }}</div>
{{ form_widget(edit_form.nombreManutentionVoulu) }}<span class="alert-danger ">{{ form_errors(edit_form.nombreManutentionVoulu) }}</span>
            </div>

        </fieldset>
    </div>

    <div class="span4">
        <fieldset> 
            <legend>Livraison : </legend>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.datelivraison," ") }}</div>
{{ form_widget(edit_form.datelivraison) }}<span class="alert-danger ">{{ form_errors(edit_form.datelivraison) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.lieulivraison," ") }}</div>
{{ form_widget(edit_form.lieulivraison) }}<span class="alert-danger ">{{ form_errors(edit_form.lieulivraison) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.naturemarchandise," ") }}</div>
{{ form_widget(edit_form.naturemarchandise) }}<span class="alert-danger ">{{ form_errors(edit_form.naturemarchandise) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.nbrecolis," ") }}</div>
{{ form_widget(edit_form.nbrecolis) }}<span class="alert-danger ">{{ form_errors(edit_form.nbrecolis) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.bonlivraison," ") }}</div>
{{ form_widget(edit_form.bonlivraison) }}<span class="alert-danger ">{{ form_errors(edit_form.bonlivraison) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.numexpedition," ") }}</div>
{{ form_widget(edit_form.numexpedition) }}<span class="alert-danger ">{{ form_errors(edit_form.numexpedition) }}</span>
            </div>

        </fieldset>
    </div>

    <div class="span3">
        <fieldset>
            <legend>P.J. :</legend>
            <div class="span2">{{ form_widget(edit_form.ecc) }} <span class="alert-danger ">{{ form_errors(edit_form.ecc) }}</span>  {{ form_label(edit_form.ecc,"ECC") }}</div>
            <div class="span2">{{ form_widget(edit_form.ect) }} <span class="alert-danger ">{{ form_errors(edit_form.ect) }}</span>  {{ form_label(edit_form.ect,"ECT") }}</div>
            <div class="span2">{{ form_widget(edit_form.ebl) }}<span class="alert-danger ">{{ form_errors(edit_form.ebl) }}</span> {{ form_label(edit_form.ebl,"EBL") }}</div>
            <div class="span2">{{ form_widget(edit_form.espece) }}<span class="alert-danger ">{{ form_errors(edit_form.espece) }}</span> {{ form_label(edit_form.espece,"ESPECE") }}</div>
            <div class="span2">{{ form_label(edit_form.autredoc," ") }} <span class="alert-danger ">{{ form_errors(edit_form.autredoc) }}</span>  {{ form_widget(edit_form.autredoc) }}</div>
        </fieldset>
    </div>
</div>


<div class="row">
    <div class="span4">
        <fieldset> 
            <legend>Contact client : </legend>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.client," ") }}</div>
<span class="">{{ form_widget(edit_form.client) }}</span><span class="alert-danger ">{{ form_errors(edit_form.client) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.clientDestinataire," ") }}</div>
{{ form_widget(edit_form.clientDestinataire) }}<span class="alert-danger ">{{ form_errors(edit_form.clientDestinataire) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.nomresponsable," ") }}</div>
{{ form_widget(edit_form.nomresponsable) }}<span class="alert-danger ">{{ form_errors(edit_form.nomresponsable) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.telresponsable," ") }}</div>
{{ form_widget(edit_form.telresponsable) }}<span class="alert-danger ">{{ form_errors(edit_form.telresponsable) }}</span>
            </div>

        </fieldset>
    </div>

    <div class="span4">
        <fieldset> 
            <legend>Facture client : </legend>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.montantfacture," ") }}</div>
{{ form_widget(edit_form.montantfacture) }}<span class="alert-danger ">{{ form_errors(edit_form.montantfacture) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.remise," ") }}</div>
{{ form_widget(edit_form.remise) }}<span class="alert-danger ">{{ form_errors(edit_form.remise) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.motifremise," ") }}</div>
{{ form_widget(edit_form.motifremise) }}<span class="alert-danger ">{{ form_errors(edit_form.motifremise) }}</span>
            </div>

            <div class="row-fluid">
 {% if entity.montantregle or entity.client.encompte %}
{{ form_widget(edit_form.montantregle, {'attr': {'checked': true}}) }}
 {%else %}
{{ form_widget(edit_form.montantregle, {'attr': {'checked': false}}) }}
{%endif %}
                <span class="alert-danger ">{{ form_errors(edit_form.montantregle) }}</span>
{{ form_label(edit_form.montantregle,"Regle") }}
            </div>

        </fieldset>
    </div> 

    <div class="span3">
        <fieldset> 
            <legend>Asssurance/Banque : </legend>
            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.valdeclassurance," ") }}</div>
{{ form_widget(edit_form.valdeclassurance) }}<span class="alert-danger ">{{ form_errors(edit_form.valdeclassurance) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.nombnq," ") }}</div>
{{ form_widget(edit_form.nombnq) }}<span class="alert-danger ">{{ form_errors(edit_form.nombnq) }}</span>
            </div>

            <div class="row-fluid">
                <div class="span1">{{ form_label(edit_form.numcheque," ") }}</div>
{{ form_widget(edit_form.numcheque) }}<span class="alert-danger ">{{ form_errors(edit_form.numcheque) }}</span>
            </div>

        </fieldset>

    </div>
</div>
{%set variable ="cacher" %}
{% if entity.etat is sameas('cloturer') or entity.etat is sameas('fdr-cloturer') or entity.etat is sameas('valider')%}
{%set variable ="" %}
{%endif%}
<div class="row-flluid {{variable}}">
    <div class="span6 {{role.confRecDocClient? "":"cacher"}}">
        <span class="span1">{{ form_widget(edit_form.confRecDocClient) }}</span>
{{ form_label(edit_form.confRecDocClient," Confirmation de reception des documents de la part du client") }}
        <span class="alert-danger ">{{ form_errors(edit_form.confRecDocClient) }}</span>
    </div>

    <div class="span6 {{role.confRecDocCtm? "":"cacher" }}">
        <span class="span1"> {{ form_widget(edit_form.confRecDocCtm) }}</span>
{{ form_label(edit_form.confRecDocCtm," Confirmation de reception des documents de la part du CTM") }}
        <span class="alert-danger ">{{ form_errors(edit_form.confRecDocCtm) }}</span>
    </div>

</div>
<div class="row-fluid">
    <div class="span12 center-block">
{{ form_widget(edit_form.submit) }}
    </div>
</div>
{{ form_end(edit_form) }}

 {%if role.affClientCompeFDL or role.affClientNnCompeFDL or role.upClientCompeFDL or role.upClientNnCompeFDL
   or role.delClientCompeFDL or role.delClientNnCompeFDL or role.cancelClientCompeFDL or role.cancelClientNnCompeFDL%}
<div class="row-fluid">
    <a href="{{ path('missionaffretement') }}" class="pull-right">
        <button class="btn btn-default">Revenir à la liste</button>
    </a>
</div>

<script>
    function verifDateRamLiv()
    {
        var htmldateRam = $("#fdr_adminbundle_missionaffretement_dateramassage_date").val();
        var htmltimeRam = $("#fdr_adminbundle_missionaffretement_dateramassage_time").val().split(":", 2);
        var dateRam = new Date(htmldateRam);
        dateRam.setHours(parseInt("0" + htmltimeRam[0]));
        dateRam.setMinutes(parseInt("0" + htmltimeRam[1]));

        var htmldateLiv = $("#fdr_adminbundle_missionaffretement_datelivraison_date").val();
        var htmltimeLiv = $("#fdr_adminbundle_missionaffretement_datelivraison_time").val().split(":", 2);
        var dateLiv = new Date(htmldateLiv);
        dateLiv.setHours(parseInt("0" + htmltimeLiv[0]));
        dateLiv.setMinutes(parseInt("0" + htmltimeLiv[1]));
        if (dateLiv <= dateRam)
        {
            alert("La date de livraison doit être supérieure à celle de ramassage");
            $("#fdr_adminbundle_missionaffretement_dateramassage_date").css('border-color', '#F00');
            $("#fdr_adminbundle_missionaffretement_dateramassage_time").css('border-color', '#F00');
            $("#fdr_adminbundle_missionaffretement_datelivraison_date").css('border-color', '#F00');
            $("#fdr_adminbundle_missionaffretement_datelivraison_time").css('border-color', '#F00');
            return false;
        }
        else {
            $("#fdr_adminbundle_missionaffretement_dateramassage_date").css('border-color', '#0F0');
            $("#fdr_adminbundle_missionaffretement_dateramassage_time").css('border-color', '#0F0');
            $("#fdr_adminbundle_missionaffretement_datelivraison_date").css('border-color', '#0F0');
            $("#fdr_adminbundle_missionaffretement_datelivraison_time").css('border-color', '#0F0');
            return true;
        }

    }
</script>

{%endif%}

{% endblock fos_user_content %}
